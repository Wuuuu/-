### 浏览器的重排重绘

### 相关问题
- 如何提升页面渲染性能
- 如何减少页面重排重绘
- 哪些行为会引起重排/重绘

浏览器渲染大致分为四个阶段，其中在解析HTML后，会一次进入Layout和Paint阶段。`样式或节点的更改，以及对布局信息的访问等`，都有可能导致重排和重绘。而重排和重绘的过程在**主线程**中进行，这意味着不合理的重排重绘会导致`渲染卡顿，用户交互滞后`等性能问题。

#### 浏览器渲染步骤
1. ParseHTML: 相关引擎分别解析文档和样式表以及脚本，生成DOM和CSSOM，最终合成Render树。
2. Layout: 浏览器通过Render树中的信息，以及递归的形式计算出每个节点的尺寸大小和页面中的具体位置。
3. Paint: 浏览器将Render树中的节点转换成在屏幕上绘制实际像素的指令，这个过程发生在多个图层上。
4. Composite: 浏览器将所有层按照一定顺序合并为一个图层并绘制在屏幕上。

DOM或者CSSOM被修改，会导致浏览器重复执行以上步骤。重排和重绘，本质上指的就是触发Layout和Paint的过程，且重排必定导致重绘。

#### 引起重排/重绘的常见操作
1. 外观有变化时，会导致**重绘**。相关的样式属性`color` `opacity`等。
2. 布局结构或节点内容发生变化时，会导致**重排**。相关的样式属性如：`height` `float` `position`等
    - 盒子尺寸和类型。
    - 定位方案（正常流、浮动和绝对定位）
    - 文档树中元素之间的关系。
    - 外部信息（如视口大小等）。
3. 获取布局信息时，会导致**重排**。相关的方法属性`offsetTop` `getComputedStyle`等。 

### 如何减少重排重绘

#### 解决方案
1. 对DOM进行批量写入和读写（通过虚拟DOM或者DocumentFragment实现）。
2. 避免对样式的频繁操作，了解常用的样式属性触发Layout/Paint/Composite的机制，合理使用样式。
3. 合理利用特殊样式属性，将渲染层提升为合成层，开启GPU加速，提高页面性能。
4. 使用变量对布局信息进行缓存，避免因频繁读取布局信息而触发重排和重绘。